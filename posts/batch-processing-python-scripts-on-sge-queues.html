<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-control" content="public">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Load favicon -->
  <link rel="shortcut icon" type="image/png" href="/images/beach-line.png"> 

  <title>Douglas Duhaime - Batch Processing Python Scripts on Sun Grid Engine Queues</title>
  <meta name="description" content="Suppose you have a collection of text files and would like to compare each of those files to each of the others. Perhaps you would like to know which charact...">

  <!-- Main CSS -->
  <link rel="stylesheet" href="/css/duhaime.css" media="screen,projection" />

  <!-- Google Font -->
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700&subset=latin-ext' rel='stylesheet' type='text/css'>

  <!-- Syntax highlighting and css -->
  <link rel="stylesheet" type="text/css" href="/css/prism.css">

  <link rel="canonical" href="http://yourdomain.com/posts/batch-processing-python-scripts-on-sge-queues">

  <link rel="alternate" type="application/rss+xml" title="Douglas Duhaime" href="http://yourdomain.com/feed.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71035937-1', 'auto');
  ga('send', 'pageview');

</script>

  
  <body> 
    <div id="coverImage"></div>
  <div class="hero" style="background-image: url('/images/cover_images/jefferys_banner.png')">
    <h1 class="display_title">Douglas Duhaime</h1>
  </div>

  <div class="container menu">
    <ul>
      <li><a href="/">Posts</a></li>
      <li><a href="/about">About</a></li
      <li><a href="/secret">Secret</a></li>
    </ul>
  <hr />
</div>

    
    <div class="container content">
      <article class="post">
  <h1 class="post-title" itemprop="name headline">Batch Processing Python Scripts on Sun Grid Engine Queues</h1>
  <time class="date">June 26, 2014</time>
  <p>Suppose you have a collection of text files and would like to compare each of those files to each of the others. Perhaps you would like to know which characters, locations, or stage directions in each file occur in any of the others. Whatever the task, if your collection is small enough—on the order of a few paragraphs, say—you can of course compare the files manually, reading each of your paragraphs in turn, and comparing the given paragraph to each of the others. If your collection is a bit bigger—on the order of a few hundred novels, say—you might automate these comparisons on your computer. If your collection is really big, however, a single computer might not be powerful enough to finish the job during your lifetime.</p>

<p>Comparing each file in a four text corpus to each of the others, after all, only involves six comparisons. Running the same analysis on a collection of 50,000 files (roughly the size of the Project Gutenberg collection in English, or the EEBO-TCP corpus), however, means running 1,249,975,000 comparisons. If each of those comparisons takes one minute to execute on your computer, it will take 2376 years to run this job on your machine. Thankfully, we can expedite this process tremendously by leveraging the power of distributed computing systems like Sun Grid Engine (SGE) queues. Pursuing the routine described above, for instance, we can use an SGE system to run each of our 1+ billion comparisons in a few minutes.</p>

<p>To get started, we’ll want to create an “iteration schedule” in which we identify all of the comparisons we wish to run. Here is a visual representation of an iteration schedule for a four text corpus:</p>

<p><img class="center-image" src="/images/post_images/batch_processing_on_sge/iteration_schedule_map.png" /></p>

<p>In the table above, each of our iterations-to-be-run is denoted by an “o.” Each “o” sits in the cell that joins the row and the column that denote the two texts to be analyzed in the given iteration. Reading across our first row, for instance, we see that text one does not need to be compared to text one, but does need to be compared to texts two, three, and four. The second row denotes that we want to compare text two to texts three and four, and row three denotes that we want to compare text three to text four.</p>

<p>After determining all of the comparisons to be run, we will want to render that information in machine-readable form. More specifically, we want to generate a table that has three columns: iteration_number, first_text, and second_text: where first_text and second_text are the file names of the two texts we wish to compare in the given iteration, and iteration_number is an integer whose value is zero in the first row of the iteration schedule, 1 in the next row, 2 in the next, . . . and n in the last, where n equals the total number of comparisons we wish to make. [In general, the number of comparisons required is (p-1)(p)/2, where p equals the number of files in your corpus.]  Here is a sample iteration table (produced by this [script][script-one]):</p>

<div>
  <pre data-line=""><code class="language-shell">0 A00002.txt A00005.txt
1 A00002.txt A00007.txt
2 A00002.txt A00008.txt
3 A00002.txt A00011.txt
4 A00002.txt A00012.txt
5 A00002.txt A00013.txt
6 A00002.txt A00014.txt
7 A00002.txt A00015.txt
8 A00002.txt A00018.txt
9 A00002.txt A00019.txt</code></pre>
</div>

<p>If you want to batch process a different kind of routine on an SGE system, you can modify your iteration schedule appropriately. If you only want to calculate the type-token ratios of each of your files, for instance, you’ll only need two columns: iteration_number and text_name. Once this iteration schedule is all set, we can turn to the script to be run during each of these iterations. <a href="https://github.com/duhaime/batch_processing_on_sge/blob/master/test.py">Here’s mine</a>: If you want to run a different kind of analysis, just keep lines 1-21 and line 102 of that script, and use the variable “iteration_number” to guide which texts you will analyze in each iteration. Once your routine is all set, save it as “test.py” and upload it—along with your iteration schedule, the files you wish to compare, and these two <a href="https://github.com/duhaime/batch_processing_on_sge/blob/master/_run_me.py">higher order scripts</a>—to a single directory on your SGE server:</p>

<p><img class="center-image" src="/images/post_images/batch_processing_on_sge/prepared_for_batch_submission.png" /></p>

<p>Once all of these files are in the same directory, you are ready to submit your script for batch processing. To do so using the University of Notre Dame’s Center for Research Computing system, you can simply type “python _run_me.py cmd_run.py your_netid” with no quotation marks:</p>

<p><img class="center-image" src="/images/post_images/batch_processing_on_sge/batch_sge_submission.png" /></p>

<p>After you submit this command, the higher-order Python scripts <em>run_me.py and cmd_run.py will create new copies of your test.py script, changing the input files for each iteration according to your iteration schedule. If all has gone well, and you refresh the directory after a few moments, you’ll see a few (or more than a few, depending on the number of iterations you are running!) new files in your directory. More specifically, you’ll have a collection of new job</em> files that give you feedback on the result of each of your iterations. If errors cropped up during your analysis, those errors should be recorded in these job_ files. Provided that there were no exceptions, though, those files will be empty, and you will find in your directory whatever output you requested in your test.py script. Et voila, now you can finish your analysis in a few minutes, rather than a few millennia!</p>

<div class="center-text">* * *</div>

<p>I want to thank Scott Hampton and Dodi Heryadi of Notre Dame’s High Performance Computing Group, who helped me think through the logistics of batch processing, Reid Johnson of Notre Dame’s Computer Science Department, who sent me the higher-order SGE scripts on which this analysis is based, and Tim Peters, who wrote many of the Python modules on which my work depends!</p>


</article>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'calculemmas'; 
        var disqus_developer = 1; // Comment out when the site is live
        /*var disqus_identifier = "/posts/batch-processing-python-scripts-on-sge-queues";*/

        /* * * Disquis Universal Template * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
</div>

    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <ul class="social-media-list">

    
      <style>
.icon--github path {
  fill: black
}
</style>

<a href="https://github.com/duhaime" style="text-decoration: none">
  <span class="icon icon--github" id="github-icon"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span>
</a>

    

    
      <style>
.icon--twitter path {
  fill: #42C0FB 
}
</style>

<a href="https://twitter.com/douglasduhaime" style="text-decoration: none">
  <span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span>
</a>

    

    </ul>
  </div>
</footer>

<!--Load assets here for async behavior-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<!-- prism js must come after content -->
<script src="/js/prism.js"></script>

<!-- lightbox assets -->
<link href="/css/lightbox.css" rel='stylesheet' type='text/css'>
<script src="/js/lightbox.js"></script>

  </body>

</html>
